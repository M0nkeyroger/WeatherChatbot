<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Proyecto Final SI UNITEC</title>
    <link href="https://fonts.googleapis.com/css2?family=Open+Sans:wght@400&display=swap" rel="stylesheet">
    <link rel="icon" href="https://www.enroll-u.com/_i/3/9/9/fe55c756-8115-11eb-a040-0295ecf211ad.jpeg?w=276&h=276&fit=crop&s=276" type="image/jpeg">
    <style>
        
        * {
            box-sizing: border-box;
        }

        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
        }

        body {
            background: linear-gradient(135deg, #044f48, #2a7561);
            background-size: cover;
            font-family: "Open Sans", sans-serif;
            font-size: 12px;
            line-height: 1.3;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .bg {
            position: fixed;
            width: 100%;
            height: 100%;
            top: 0;
            left: 0;
            z-index: 1;
            background: url('https://images.unsplash.com/photo-1451186859696-371d9477be93?crop=entropy&fit=crop&fm=jpg&h=975&ixjsv=2.1.0&ixlib=rb-0.3.5&q=80&w=1925') no-repeat center center;
            background-size: cover;
            filter: blur(5px);
            transform: scale(1.2);
        }

        .container {
            position: relative;
            z-index: 2;
            display: flex;
            gap: 20px;
        }

        /*--------------------
        Chat
        --------------------*/
        .chat {
            width: 300px;
            height: 80vh;
            max-height: 500px;
            overflow: hidden;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
        }

        /*--------------------
        Chat Title
        --------------------*/
        .chat-title {
            flex: 0 1 45px;
            position: relative;
            background: rgba(0, 0, 0, 0.2);
            color: #fff;
            text-transform: uppercase;
            text-align: left;
            padding: 10px 10px 10px 50px;
        }

        .chat-title h1,
        .chat-title h2 {
            font-weight: normal;
            margin: 0;
            padding: 0;
        }

        .chat-title h2 {
            color: rgba(255, 255, 255, 0.5);
            font-size: 8px;
            letter-spacing: 1px;
        }

        .avatar {
            position: absolute;
            top: 5px;
            left: -25px; /* Previously 9px */
            border-radius: 30px;
            width: 30px;
            height: 30px;
            overflow: hidden;
            border: 2px solid rgba(255, 255, 255, 0.24);
        }

        .avatar img {
            width: 100%;
            height: auto;
        }

        /*--------------------
        Messages
        --------------------*/
        .messages {
            flex: 1 1 auto;
            color: rgba(255, 255, 255, 0.5);
            overflow: hidden;
            position: relative;
            width: 100%;
        }

        .messages-content {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            width: 100%;
            overflow-y: auto; /* Enable vertical scrolling */
            padding: 10px; /* Add padding to the messages */
        }

        .message {
            clear: both;
            padding: 6px 10px;
            border-radius: 10px 10px 10px 0;
            background: rgba(0, 0, 0, 0.3);
            margin: 8px 0;
            font-size: 11px;
            line-height: 1.4;
            position: relative;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.2);
        }

        .message-personal {
            float: right;
            color: #fff;
            text-align: right;
            background: linear-gradient(120deg, #248A52, #257287);
            border-radius: 10px 10px 0 10px;
        }

        .message-box {
            flex: 0 1 40px;
            width: 100%;
            background: rgba(0, 0, 0, 0.3);
            padding: 10px;
            position: relative;
        }

        .message-input {
            background: none;
            border: none;
            outline: none!important;
            resize: none; /* Make the input a fixed size */
            color: rgba(255, 255, 255, 0.7);
            font-size: 11px;
            height: 40px; /* Set height for textarea */
            margin: 0;
            padding: 10px; /* Add padding for textarea */
            width: calc(100% - 80px); /* Adjust width for padding and button */
            border-radius: 10px; /* Rounded corners */
            box-shadow: inset 0 1px 1px rgba(255, 255, 255, 0.2);
            overflow-y: auto; /* Enable vertical scrolling for textarea */
        }

        .message-submit {
            position: absolute;
            z-index: 1;
            top: 10px;
            right: 10px;
            color: #fff;
            border: none;
            background: none;
            cursor: pointer;
            font-size: 11px; /* Adjust font size */
            padding: 10px 15px; /* Add padding to button */
            border-radius: 5px; /* Rounded corners */
            background: rgba(255, 255, 255, 0.2); /* Background for button */
        }

        /*--------------------
        Custom Scrollbar
        --------------------*/
        .messages-content::-webkit-scrollbar,
        .message-input::-webkit-scrollbar {
            width: 1px; /* Width of the scrollbar */
        }

        .messages-content::-webkit-scrollbar-track,
        .message-input::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3); /* Background of the scrollbar track */
        }

        .messages-content::-webkit-scrollbar-thumb,
        .message-input::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.5); /* Color of the scrollbar thumb */
            border-radius: 10px; /* Rounded edges for the scrollbar thumb */
        }

        .messages-content::-webkit-scrollbar-thumb:hover,
        .message-input::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.7); /* Color on hover */
        }

        /*--------------------
        Custom Scrollbar for Side Panel
        --------------------*/
        .side-panel::-webkit-scrollbar {
            width: 1px; /* Width of the scrollbar */
        }

        .side-panel::-webkit-scrollbar-track {
            background: rgba(0, 0, 0, 0.3); /* Background of the scrollbar track */
        }

        .side-panel::-webkit-scrollbar-thumb {
            background-color: rgba(0, 0, 0, 0.5); /* Color of the scrollbar thumb */
            border-radius: 10px; /* Rounded edges for the scrollbar thumb */
        }

        .side-panel::-webkit-scrollbar-thumb:hover {
            background-color: rgba(255, 255, 255, 0.7); /* Color on hover */
        }

        /*--------------------
        Side Panel
        --------------------*/
        .side-panel {
            width: 300px;
            height: 90vh;
            max-height: 630px;
            overflow-y: auto;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 20px;
            color: #fff;
            font-size: 12px;
            float: left; /* Ensure panels are side by side */
            margin-right: 20px; /* Space between panels */
        }
        .side-panel h2 {
            text-align: center;
        }


        /* New Equipo Panel Specific Styles */
        .equipo-panel {
            /* Inherits styles from .side-panel */
            width: 300px;
            height: 90vh;
            max-height: 190px;
            overflow-y: auto;
            box-shadow: 0 5px 30px rgba(0, 0, 0, 0.2);
            background: rgba(0, 0, 0, 0.5);
            border-radius: 20px;
            padding: 20px;
            color: #fff;
            font-size: 12px;
            float: left; /* Ensure panels are side by side */
            margin-right: 20px; /* Space between panels */
        }

        .equipo-panel h2 {
            text-align: center;
        }
        .equipo-panel li {
            text-align: center;
        }

    </style>
</head>
<body>

    <div class="bg"></div> <!-- Background -->
    
    <div class="container">
        <div class="side-panel">
            <h2>Capacidades del Bot</h2>
            <ul>
                <li>Proporcionar la hora actual.</li>
                <li>Informar el día y la fecha de hoy.</li>
                <li>Ofrecer información sobre el clima de una ciudad específica.</li>
                <li>Responder preguntas generales sobre diversos temas.</li>
                <li>Ayudar con recomendaciones de actividades según el clima.</li>
                <li>Guardar y gestionar conversaciones previas.</li>
                <li>Actualizar la ubicación para obtener información precisa.</li>
                <li>Proporcionar asistencia en múltiples idiomas.</li>
                <li>Realizar cálculos básicos y conversiones.</li>
                <li>Brindar soporte técnico básico para problemas comunes.</li>
            </ul>
            <h2>Limitaciones</h2>
            <ul>
                <li>No puede acceder a información personal sin autorización.</li>
                <li>Las respuestas se basan en datos disponibles hasta 2023.</li>
                <li>No realiza acciones físicas ni transacciones monetarias.</li>
                <li>Puede tener limitaciones en comprensión de contextos muy específicos.</li>
                <li>No sustituye asesoría profesional en áreas especializadas.</li>
            </ul>
        </div>

        <div class="chat">
            <div class="chat-title">
                <h1>Chatbot del Clima</h1>
                <h2>UNITEC Campus Queretaro</h2>
                <figure class="avatar">
                    <img src="https://www.enroll-u.com/_i/3/9/9/fe55c756-8115-11eb-a040-0295ecf211ad.jpeg?w=276&h=276&fit=crop&s=276" />
                </figure>
            </div>
            <div class="messages">
                <div id="chatbox" class="messages-content"></div>
            </div>
            <div class="message-box">
                <textarea id="user-input" class="message-input" placeholder="Escribe tu mensaje aquí..."></textarea>
                <button id="send-button" class="message-submit">Enviar</button>
            </div>
        </div>

        <div class="side-panel equipo-panel">
            <h2>Equipo</h2>
            <ul>
                <li>Jürgen Alfredo Zellhuber Martínez</li>
                <li>Andrés Enrique Cobo Vecchionacce</li>
                <li>Fernanda Ortiz Rivera</li>
                <li>Alexander Orozco Ortiz</li>
                <li>Humberto Altamirano Aguilar</li>
            </ul>
        </div>
    </div>

    <script>
        const chatbox = document.getElementById("chatbox");
        const userInput = document.getElementById("user-input");
        const sendButton = document.getElementById("send-button");
        let locationData = null;

        // Function to add a message to the chatbox
        function addMessage(message, sender) {
            const messageElement = document.createElement("div");
            messageElement.className = sender === "Chatbot" ? "message" : "message message-personal";
            messageElement.textContent = message;
            chatbox.appendChild(messageElement);
            chatbox.scrollTop = chatbox.scrollHeight;
        }

        // Send user input to the chatbot and get a response
        async function sendMessage() {
            const message = userInput.value.trim();
            if (message === "") return;

            addMessage(message, "You");
            userInput.value = ""; // Clear input field

            const response = await fetch("/chat", {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ message, locationData })
            });

            const data = await response.json();

            if (message.toLowerCase().includes("hora")) {
                if (!locationData) {
                    addMessage("No se ha obtenido la ubicación. Por favor, intenta nuevamente.", "Chatbot");
                    return;
                }
                try {
                    const timeResponse = await fetch(`/get_time?lat=${locationData.latitude}&lon=${locationData.longitude}`);
                    const timeData = await timeResponse.json();

                    if (timeData.error) {
                        addMessage(`Error: ${timeData.error}`, "Chatbot");
                        return;
                    }

                    const currentTime = new Date(timeData.datetime).toLocaleTimeString('es-ES', { hour: '2-digit', minute: '2-digit' });
                    addMessage(`¡Claro! Déjame ver... En este momento son las ${currentTime}. ¿Hay algo más en lo que pueda ayudarte?`, "Chatbot");
                } catch (error) {
                    console.error(error);
                    addMessage("Ocurrió un error al obtener la hora. Por favor, intenta nuevamente.", "Chatbot");
                }
            } else if (message.toLowerCase().includes("día") || message.toLowerCase().includes("dia")) {
                if (!locationData) {
                    addMessage("No se ha obtenido la ubicación. Por favor, intenta nuevamente.", "Chatbot");
                    return;
                }
                try {
                    const timeResponse = await fetch(`/get_time?lat=${locationData.latitude}&lon=${locationData.longitude}`);
                    const timeData = await timeResponse.json();

                    if (timeData.error) {
                        addMessage(`Error: ${timeData.error}`, "Chatbot");
                        return;
                    }

                    const datetime = new Date(timeData.datetime);
                    const options = { 
                        weekday: 'long', 
                        year: 'numeric', 
                        month: 'long', 
                        day: 'numeric' 
                    };
                    const currentDate = datetime.toLocaleDateString('es-ES', options);
                    addMessage(`Hoy es ${currentDate}. ¿Hay algo más en lo que pueda ayudarte?`, "Chatbot");
                } catch (error) {
                    console.error(error);
                    addMessage("Ocurrió un error al obtener la fecha. Por favor, intenta nuevamente.", "Chatbot");
                }
            } else {
                addMessage(data.response, "Chatbot");
            }
        }

        sendButton.addEventListener("click", sendMessage);
        userInput.addEventListener("keypress", (e) => {
            if (e.key === "Enter" && !e.shiftKey) {
                e.preventDefault();
                sendMessage();
            }
        });

        // Function to get the user's location and store it
        async function getLocationAndTime() {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition((position) => {
                    locationData = {
                        latitude: position.coords.latitude,
                        longitude: position.coords.longitude
                    };
                }, () => {
                    addMessage("No se pudo obtener tu ubicación.", "Chatbot");
                });
            } else {
                addMessage("La geolocalización no es soportada por este navegador.", "Chatbot");
            }
        }

        // Display the initial greeting message on page load
        window.onload = async () => {
            const initialGreetingMessage = "¡Hola! Soy tu asistente virtual, capaz de proporcionarte información sobre el clima y ayudarte con una variedad de preguntas. Por favor, proporciona una ciudad para que pueda darte la información del clima. Puedes escribir 'clima' en cualquier momento para cambiar la ubicación.";
            addMessage(initialGreetingMessage, "Chatbot");
            getLocationAndTime();
        };
    </script>

</body>
</html>